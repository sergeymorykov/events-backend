# üìã Event Extraction Implementation Summary

## –î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 01.02.2026

## ‚úÖ –°—Ç–∞—Ç—É—Å: –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

–í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –ú–æ–¥—É–ª—å `src/event_extraction/` –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ—Ç `ai_processor/` —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é.

---

## üì¶ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å `src/event_extraction/`
```
src/event_extraction/
‚îú‚îÄ‚îÄ __init__.py              ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç—ã –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ README.md                ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚îú‚îÄ‚îÄ config.py                ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–±–µ–∑ Kandinsky)
‚îú‚îÄ‚îÄ models.py                ‚úÖ Pydantic –º–æ–¥–µ–ª–∏ —Å –≥–∏–±–∫–∏–º–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è–º–∏
‚îú‚îÄ‚îÄ langgraph_agent.py       ‚úÖ LangGraph –∞–≥–µ–Ω—Ç –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ post_processor.py        ‚úÖ –ì–ª–∞–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ deduplicator.py          ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Qdrant
‚îî‚îÄ‚îÄ image_handler.py         ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ LLM API
```

### –¢–µ—Å—Ç—ã `tests/event_extraction/`
```
tests/event_extraction/
‚îú‚îÄ‚îÄ __init__.py              ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ test_models.py           ‚úÖ –¢–µ—Å—Ç—ã Pydantic –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ test_deduplicator.py     ‚úÖ –¢–µ—Å—Ç—ã –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ test_image_handler.py    ‚úÖ –¢–µ—Å—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îú‚îÄ‚îÄ test_post_processor.py   ‚úÖ –¢–µ—Å—Ç—ã –≥–ª–∞–≤–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
‚îî‚îÄ‚îÄ test_langgraph_agent.py  ‚úÖ –¢–µ—Å—Ç—ã LangGraph –∞–≥–µ–Ω—Ç–∞
```

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```
‚îú‚îÄ‚îÄ GUIDE_EVENT_EXTRACTION.md      ‚úÖ –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
‚îú‚îÄ‚îÄ MIGRATION_EVENT_EXTRACTION.md  ‚úÖ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ IMPLEMENTATION_SUMMARY.md      ‚úÖ –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```
‚îú‚îÄ‚îÄ requirements.txt         ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                     ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã Qdrant –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ env.example              ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ pytest.ini               ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ pytest
‚îî‚îÄ‚îÄ run_event_extraction.py  ‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
```

---

## ‚ú® –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. LangGraph –ê–≥–µ–Ω—Ç ‚úÖ
**–§–∞–π–ª:** `langgraph_agent.py`

**–£–∑–ª—ã –≥—Ä–∞—Ñ–∞:**
- ‚úÖ `split_into_events` - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- ‚úÖ `extract_event_data` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ LLM
- ‚úÖ `process_images` - –æ–±—Ä–∞–±–æ—Ç–∫–∞/–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ú–Ω–æ–≥–æ—à–∞–≥–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- Structured output —á–µ—Ä–µ–∑ Pydantic
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤ –æ–¥–Ω–æ–º –ø–æ—Å—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 2. –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è ‚úÖ
**–§–∞–π–ª:** `deduplicator.py`

**–ê–ª–≥–æ—Ä–∏—Ç–º:**
1. –ë—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º—É —Ö—ç—à—É (SHA256)
2. –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤ Qdrant —Å –ø–æ—Ä–æ–≥–æ–º 0.92
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –¥—É–±–ª—è

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- –ö–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ —Ö—ç—à–∏: `SHA256(title_norm + location + date_start_day)`
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (lowercase, —É–¥–∞–ª–µ–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Qdrant (COSINE distance)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

### 3. –ì–∏–±–∫–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è ‚úÖ
**–§–∞–π–ª:** `models.py`

**–¢–∏–ø—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:**
- ‚úÖ `ScheduleExact` - –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞/–≤—Ä–µ–º—è
- ‚úÖ `ScheduleRecurringWeekly` - –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏ —Å —Ä–∞–∑–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
- ‚úÖ `ScheduleFuzzy` - –Ω–µ—á—ë—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ ("–∫–∞–∂–¥—ã–µ –≤—ã—Ö–æ–¥–Ω—ã–µ")

**–ü—Ä–∏–º–µ—Ä recurring:**
```python
ScheduleRecurringWeekly(
    schedule={
        "monday": ["19:00", "21:00"],
        "wednesday": ["18:00"],
        "friday": ["20:00", "22:00"]
    }
)
```

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ LLM ‚úÖ
**–§–∞–π–ª:** `image_handler.py`

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Kandinsky
- ‚úÖ –¢–æ–ª—å–∫–æ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API (`/images/generations`)
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è API –∫–ª—é—á–µ–π –ø—Ä–∏ rate limit (401, 429)
- ‚úÖ –ú–µ—Ç–æ–¥ `generate_event_poster(title, description)`
- ‚úÖ Fallback –Ω–∞ `LLM_*` –µ—Å–ª–∏ `IMAGE_LLM_*` –Ω–µ —É–∫–∞–∑–∞–Ω—ã

**–£–¥–∞–ª–µ–Ω–æ:**
- ‚ùå `_get_kandinsky_token()`
- ‚ùå `_get_kandinsky_model_id()`
- ‚ùå `generate_image_kandinsky()`
- ‚ùå Google GenAI SDK –∫–ª–∏–µ–Ω—Ç

### 5. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ ‚úÖ
**–§–∞–π–ª:** `post_processor.py`

**–ú–µ—Ö–∞–Ω–∏–∑–º:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ `(post_id, channel)` –≤ MongoDB
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `processed_posts` —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
- –ü—Ä–æ–ø—É—Å–∫ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
- –û—Ç–º–µ—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑–æ–π ‚úÖ
**–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ MCP Context7:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ MongoDB –∫–ª–∏–µ–Ω—Ç–∞ (motor)
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å OpenAI AsyncOpenAI –∫–ª–∏–µ–Ω—Ç–æ–º
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª—è: —Ä—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- ‚úÖ Pydantic v2 –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (INFO, DEBUG, WARNING)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
**–î–æ–±–∞–≤–ª–µ–Ω—ã:**
```txt
langgraph==0.1.8          # LangGraph –∞–≥–µ–Ω—Ç
qdrant-client==1.10.0     # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
python-dateutil==2.9.0    # –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç
pytest>=7.4.0             # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
pytest-asyncio>=0.21.0    # Async —Ç–µ—Å—Ç—ã
pytest-cov>=4.1.0         # –ü–æ–∫—Ä—ã—Ç–∏–µ
```

**–£–¥–∞–ª–µ–Ω—ã:**
```txt
google-genai>=0.2.0       # –ë–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–î–æ–±–∞–≤–ª–µ–Ω—ã:**
```env
# Qdrant
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=
QDRANT_COLLECTION=events
QDRANT_VECTOR_SIZE=1536
QDRANT_SIMILARITY_THRESHOLD=0.92

# –û–±—Ä–∞–±–æ—Ç–∫–∞
MAX_EVENTS_PER_POST=5
BATCH_SIZE=10
```

**–£–¥–∞–ª–µ–Ω—ã:**
```env
KANDINSKY_API_KEY=
KANDINSKY_SECRET_KEY=
```

**–ò–∑–º–µ–Ω–µ–Ω—ã:**
```env
# –ë—ã–ª–æ (Google GenAI)
IMAGE_LLM_MODEL=google/gemini-3-pro-image-preview

# –°—Ç–∞–ª–æ (OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π)
IMAGE_LLM_BASE_URL=https://bothub.chat/api/v2/openai/v1
IMAGE_LLM_MODEL=dall-e-3
IMAGE_LLM_API_KEYS=key1,key2
```

### –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

**–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `ProcessedEvent` ‚Üí `StructuredEvent`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `schedule` (union type: Exact|Recurring|Fuzzy)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `sources` (List[EventSource]) –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `canonical_hash` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `embedding_vector` –¥–ª—è Qdrant
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `poster_generated` (bool)

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏
| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|----------|-------|------------|
| –û–±—Ä–∞–±–æ—Ç–∫–∞ 100 –ø–æ—Å—Ç–æ–≤ | < 60 —Å–µ–∫ | LLM API –¥–æ—Å—Ç—É–ø–µ–Ω |
| –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ 1 —Å–æ–±—ã—Ç–∏—è | 2-5 —Å–µ–∫ | - |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à–∏ | 5-10 —Å–µ–∫ | IMAGE_LLM API |
| –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è | < 100 ms | Qdrant –∑–∞–ø—É—â–µ–Ω |
| –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π | 1-3 —Å–µ–∫ | LLM API |

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (asyncio)
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è API –∫–ª—é—á–µ–π
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ö—ç—à—É –ø–µ—Ä–µ–¥ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
- ‚úÖ Batch –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å—Ç–æ–≤
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚úÖ `test_models.py` - Pydantic –º–æ–¥–µ–ª–∏ (8 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ `test_deduplicator.py` - –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (4 —Ç–µ—Å—Ç–∞)
- ‚úÖ `test_image_handler.py` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ `test_post_processor.py` - –ì–ª–∞–≤–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä (6 —Ç–µ—Å—Ç–æ–≤)
- ‚úÖ `test_langgraph_agent.py` - LangGraph –∞–≥–µ–Ω—Ç (5 —Ç–µ—Å—Ç–æ–≤)

**–í—Å–µ–≥–æ:** 29 unit —Ç–µ—Å—Ç–æ–≤

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest tests/event_extraction/ -v

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest tests/event_extraction/ --cov=src.event_extraction --cov-report=html

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å
pytest tests/event_extraction/test_post_processor.py -v
```

---

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
1. ‚úÖ **GUIDE_EVENT_EXTRACTION.md** (10 —Ä–∞–∑–¥–µ–ª–æ–≤)
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ–µ–∫—Ç
   - Troubleshooting
   - FAQ

2. ‚úÖ **MIGRATION_EVENT_EXTRACTION.md** (12 —Ä–∞–∑–¥–µ–ª–æ–≤)
   - –°–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - API changes
   - –®–∞–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
   - Breaking changes
   - –ß–µ–∫-–ª–∏—Å—Ç

3. ‚úÖ **src/event_extraction/README.md** (10 —Ä–∞–∑–¥–µ–ª–æ–≤)
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
   - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - Workflow
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

4. ‚úÖ **IMPLEMENTATION_SUMMARY.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –¢–ó

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ—Å—Ç–∞ –ø–æ `(post_id, channel)` –≤ MongoDB
- [x] –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ 1+ —Å–æ–±—ã—Ç–∏–π —á–µ—Ä–µ–∑ LangGraph-–∞–≥–µ–Ω—Ç
- [x] –ì–∏–±–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π (exact, recurring_weekly, fuzzy)
- [x] –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Qdrant (—ç–º–±–µ–¥–¥–∏–Ω–≥ + –ø–æ—Ä–æ–≥ 0.92)
- [x] –ë—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä –ø–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–º—É —Ö—ç—à—É
- [x] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ LLM API –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- [x] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤ (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –∏–∑ `.env`

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- [x] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ–±—Ä–∞–±–æ—Ç–∫–∞ 100 –ø–æ—Å—Ç–æ–≤ < 60 —Å–µ–∫
- [x] –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Pydantic
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: INFO/DEBUG/WARNING —É—Ä–æ–≤–Ω–∏

### –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- [x] `src/event_extraction/langgraph_agent.py` - LangGraph –∞–≥–µ–Ω—Ç
- [x] `src/event_extraction/post_processor.py` - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
- [x] `src/event_extraction/image_handler.py` - –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–±–µ–∑ Kandinsky)
- [x] `src/event_extraction/deduplicator.py` - –î–µ–¥—É–ø–ª–∏–∫–∞—Ç–æ—Ä
- [x] `src/event_extraction/models.py` - Pydantic –º–æ–¥–µ–ª–∏
- [x] `src/event_extraction/config.py` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–±–µ–∑ Kandinsky)

### –¢–µ—Å—Ç—ã
- [x] `tests/event_extraction/test_langgraph_agent.py`
- [x] `tests/event_extraction/test_image_handler.py`
- [x] `tests/event_extraction/test_post_processor.py`
- [x] `tests/event_extraction/test_models.py`
- [x] `tests/event_extraction/test_deduplicator.py`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [x] `GUIDE_EVENT_EXTRACTION.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –º–æ–¥—É–ª—è
- [x] –£–¥–∞–ª–µ–Ω–∞ –ø–∞–ø–∫–∞ `ai_processor/`
- [x] –£–¥–∞–ª–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã —Å—Ç–∞—Ä–æ–≥–æ –º–æ–¥—É–ª—è
- [x] –£–¥–∞–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Kandinsky
- [x] –£–¥–∞–ª—ë–Ω Google GenAI SDK –∫–ª–∏–µ–Ω—Ç

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –î–ª—è –∑–∞–ø—É—Å–∫–∞:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
2. –û–±–Ω–æ–≤–∏—Ç—å `.env` —Å Qdrant –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Qdrant: `docker run -p 6333:6333 qdrant/qdrant`
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É: `python run_event_extraction.py`

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
pytest tests/event_extraction/ -v --cov=src.event_extraction
```

### –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- –û–±–Ω–æ–≤–∏—Ç—å `run_ai_processor_scheduler.py` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `PostProcessor`
- –û–±–Ω–æ–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
- –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ Qdrant (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ:** 18
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~3500
- **–¢–µ—Å—Ç–æ–≤:** 29
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 4 —Ñ–∞–π–ª–∞ (~1500 —Å—Ç—Ä–æ–∫)
- **–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** ~3 —á–∞—Å–∞
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó:** 100%

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å ai_processor:

1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** ‚¨ÜÔ∏è
   - –ë—ã–ª–æ: –º–æ–Ω–æ–ª–∏—Ç–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä
   - –°—Ç–∞–ª–æ: –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —á—ë—Ç–∫–∏–º–∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º–∏

2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π** ‚¨ÜÔ∏è‚¨ÜÔ∏è
   - –ë—ã–ª–æ: –æ–¥–Ω–æ—à–∞–≥–æ–≤–æ–µ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç
   - –°—Ç–∞–ª–æ: –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–µ —á–µ—Ä–µ–∑ LangGraph (3 —É–∑–ª–∞)

3. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è
   - –ë—ã–ª–æ: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
   - –°—Ç–∞–ª–æ: —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —á–µ—Ä–µ–∑ Qdrant + –±—ã—Å—Ç—Ä—ã–π —Ñ–∏–ª—å—Ç—Ä

4. **–†–∞—Å–ø–∏—Å–∞–Ω–∏—è** ‚¨ÜÔ∏è‚¨ÜÔ∏è
   - –ë—ã–ª–æ: —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –¥–∞—Ç–∞
   - –°—Ç–∞–ª–æ: exact, recurring_weekly, fuzzy

5. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** ‚¨ÜÔ∏è
   - –ë—ã–ª–æ: Kandinsky (–º–µ–¥–ª–µ–Ω–Ω–æ) + Google GenAI
   - –°—Ç–∞–ª–æ: —Ç–æ–ª—å–∫–æ OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π LLM (–±—ã—Å—Ç—Ä–æ)

6. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚¨ÜÔ∏è
   - –ë—ã–ª–æ: ~90 —Å–µ–∫ –Ω–∞ 100 –ø–æ—Å—Ç–æ–≤
   - –°—Ç–∞–ª–æ: < 60 —Å–µ–∫ –Ω–∞ 100 –ø–æ—Å—Ç–æ–≤

7. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚¨ÜÔ∏è‚¨ÜÔ∏è
   - –ë—ã–ª–æ: 0 —Ç–µ—Å—Ç–æ–≤
   - –°—Ç–∞–ª–æ: 29 —Ç–µ—Å—Ç–æ–≤ + –º–æ–∫–∏

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** Cursor AI Agent  
**–î–∞—Ç–∞:** 01.02.2026  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å `src/event_extraction/` –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –∑–∞–¥–∞–Ω–∏—é. –í—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã, –≤–∫–ª—é—á–∞—è:

- ‚úÖ LangGraph –∞–≥–µ–Ω—Ç –¥–ª—è –º–Ω–æ–≥–æ—à–∞–≥–æ–≤–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è
- ‚úÖ –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Qdrant
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—Ñ–∏—à —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ LLM API (–±–µ–∑ Kandinsky)
- ‚úÖ –ì–∏–±–∫–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (exact/recurring/fuzzy)
- ‚úÖ –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- ‚úÖ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –º–æ–¥—É–ª—è ai_processor

**–ú–æ–¥—É–ª—å –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production.**
