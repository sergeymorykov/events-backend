# events-backend

–ë—ç–∫–µ–Ω–¥ —á–∞—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π.

> üöÄ **[–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç ‚Üí](QUICKSTART.md)** ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Ä–∞–±–æ—Ç—É –∑–∞ 5 –º–∏–Ω—É—Ç!

## Telegram Parser

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤ –∏–∑ –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram-–∫–∞–Ω–∞–ª–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ MongoDB.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Telethon
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞, –¥–∞—Ç—ã, ID, URL –ø–æ—Å—Ç–æ–≤
- ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è —Ñ–æ—Ç–æ –∏ –º–µ–¥–∏–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MongoDB (–∫–æ–ª–ª–µ–∫—Ü–∏—è `raw_posts`)
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ `post_id`
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ rate limits (FloodWaitError)
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repo-url>
cd events-backend
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:
```bash
cp .env.example .env
```

4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª:
```env
# –ü–æ–ª—É—á–∏—Ç–µ credentials –Ω–∞ https://my.telegram.org/apps
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash

# Username –∫–∞–Ω–∞–ª–∞ (–±–µ–∑ @)
TELEGRAM_CHANNEL_USERNAME=durov

# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ—Å—Ç–æ–≤
POSTS_LIMIT=100

# MongoDB
MONGODB_URI=mongodb://localhost:27017/
MONGODB_DB_NAME=events_db
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
```bash
python check_config.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MongoDB
- ‚úÖ –ù–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏ Telethon

#### 2. –ó–∞–ø—É—Å–∫ –ø–∞—Ä—Å–µ—Ä–∞

```bash
python telegram_parser.py
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ Telethon –ø–æ–ø—Ä–æ—Å–∏—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è:
1. –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
2. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ Telegram
3. –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ 2FA ‚Äî –≤–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å

–°–µ—Å—Å–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `*.session`, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

#### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ –∏–∑ –ø–æ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:

```bash
# –°–∫–∞—á–∞—Ç—å –≤—Å–µ —Ñ–æ—Ç–æ
python download_photos.py

# –°–∫–∞—á–∞—Ç—å —Ç–æ–ª—å–∫–æ 10 —Ñ–æ—Ç–æ
python download_photos.py --limit 10
```

–§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `downloaded_photos/` (–∏–ª–∏ –¥—Ä—É–≥—É—é, —É–∫–∞–∑–∞–Ω–Ω—É—é –≤ `PHOTOS_DIR`).

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB

–ö–æ–ª–ª–µ–∫—Ü–∏—è `raw_posts`:
```python
{
    "post_id": 123,                           # ID —Å–æ–æ–±—â–µ–Ω–∏—è (unique index)
    "channel_username": "durov",              # Username –∫–∞–Ω–∞–ª–∞
    "text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞",                    # –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    "date": ISODate("2024-01-01T12:00:00Z"), # –î–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
    "post_url": "https://t.me/durov/123",    # URL –ø–æ—Å—Ç–∞
    "photo_info": {                           # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ç–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        "photo_id": 123456789,                # ID —Ñ–æ—Ç–æ –≤ Telegram
        "access_hash": 987654321,             # Hash –¥–ª—è –¥–æ—Å—Ç—É–ø–∞
        "file_reference": "abc123...",        # –°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª
        "date": ISODate("2024-01-01T12:00:00Z"),
        "has_stickers": false,
        "dc_id": 2,                           # ID –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞
        "width": 1280,                        # –®–∏—Ä–∏–Ω–∞ —Ñ–æ—Ç–æ
        "height": 720,                        # –í—ã—Å–æ—Ç–∞ —Ñ–æ—Ç–æ
        "size_type": "PhotoSize"              # –¢–∏–ø —Ä–∞–∑–º–µ—Ä–∞
    },
    "views": 1000,                            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
    "forwards": 50,                           # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ—Å—ã–ª–æ–∫
    "parsed_at": ISODate("2024-01-01T13:00:00Z"), # –í—Ä–µ–º—è –ø–∞—Ä—Å–∏–Ω–≥–∞
    "has_media": true,                        # –ù–∞–ª–∏—á–∏–µ –º–µ–¥–∏–∞
    "media_type": "MessageMediaPhoto"         # –¢–∏–ø –º–µ–¥–∏–∞
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è:
- –í —Ñ–∞–π–ª `telegram_parser.log`
- –í –∫–æ–Ω—Å–æ–ª—å (stdout)

–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:
- INFO ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- WARNING ‚Äî rate limits, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- ERROR ‚Äî –æ—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ
- CRITICAL ‚Äî –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **FloodWaitError** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
- **ChannelPrivateError** ‚Äî –∫–∞–Ω–∞–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **ChannelInvalidError** ‚Äî –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π username –∫–∞–Ω–∞–ª–∞
- **DuplicateKeyError** ‚Äî –ø–æ—Å—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è)
- **ServerSelectionTimeoutError** ‚Äî –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ MongoDB

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- Python 3.11+
- Telethon (Telegram API)
- pymongo (MongoDB driver)
- python-dotenv (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- asyncio (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å)
